/*! SOSI.js 03-10-2013 */
var SOSI=window.SOSI||{};!function(a){"use strict";a.Base=function(){this.initialize.apply(this,arguments)},_.extend(a.Base.prototype,{initialize:function(){}});var b=function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.__super__=d.prototype,c};a.Base.extend=b}(SOSI);var SOSI=window.SOSI||{};!function(a){"use strict";a.util={cleanupLine:function(a){return-1!==a.indexOf("!")&&(a=a.substring(0,a.indexOf("!"))),a.replace(/\s\s*$/,"")},countStartingDots:function(a){var b=!1;return _.reduce(a,function(a,c){return"."!==c||b?b=!0:a++,a},0)}},a.koordsysMap={1:"EPSG:27391",2:"EPSG:27392",3:"EPSG:27393",4:"EPSG:27394",5:"EPSG:27395",6:"EPSG:27396",7:"EPSG:27397",8:"EPSG:27398",9:"EPSG:4273"}}(SOSI);var SOSI=window.SOSI||{};!function(a){"use strict";function b(a){var b=a.split(" "),c={};return c[b.shift()]=b.join(" "),c}function c(a,b){return a[b].replace(/"/g,"")}function d(a,b){return parseFloat(a[b])}function e(b){if(b=parseInt(b),a.koordsysMap[b])return a.koordsysMap[b];throw new Error("KOORDSYS = "+b+" not found!")}function f(a){var b=["maalemetode","noyaktighet","synbarhet","h-maalemetode","h-noyaktighet","max-avvik"];if(_.isString(a))return _.reduce(a.split(" "),function(a,c,d){return a[b[d]]=parseInt(c,10),a},{});throw new Error("Reading KVALITET as subfields not implemented!")}function g(a){var b=a["MIN-NØ"].split(" "),c=a["MAX-NØ"].split(" ");return[parseFloat(b[1]),parseFloat(b[0]),parseFloat(c[1]),parseFloat(c[0])]}function h(a){return a=a.split(" "),{x:parseFloat(a[1]),y:parseFloat(a[0])}}a.Head=a.Base.extend({initialize:function(a){this.setData(a)},parse:function(c){var d,e=_.reduce(c,function(c,e){return e=a.util.cleanupLine(e),2===a.util.countStartingDots(e)?(e=e.replace("..",""),1===e.split(" ").length?(c[e]=[],d=e):_.extend(c,b(e))):c[d].push(e),c},{});return _.reduce(e,function(a,c,d){return a[d]=_.isArray(c)?_.reduce(c,function(a,c){return _.extend(a,b(c.replace("...","")))},{}):c,a},{})},setData:function(a){a=this.parse(a),this.eier=c(a,"EIER"),this.produsent=c(a,"PRODUSENT"),this.objektkatalog=c(a,"OBJEKTKATALOG"),this.verifiseringsdato=c(a,"VERIFISERINGSDATO"),this.version=d(a,"SOSI-VERSJON"),this.level=d(a,"SOSI-NIVÅ"),this.kvalitet=f(a.KVALITET),this.bbox=g(a.OMRÅDE),this.origo=h(a.TRANSPAR["ORIGO-NØ"]),this.enhet=parseFloat(a.TRANSPAR.ENHET),this.vertdatum=c(a.TRANSPAR,"VERT-DATUM"),this.srid=e(a.TRANSPAR.KOORDSYS)}})}(SOSI);var SOSI=window.SOSI||{};!function(a){"use strict";a.Point=a.Base.extend({initialize:function(a,b,c){var d=a[0].split(" ");this.y=parseInt(d[0],10)*c+b.y,this.x=parseInt(d[1],10)*c+b.x}})}(SOSI);var SOSI=window.SOSI||{};!function(a){"use strict";function b(b,c,d,e){var f={PUNKT:a.Point};return f[b]?new f[b](c,d,e):null}a.Feature=a.Base.extend({initialize:function(a,b,c){if(!a.id)throw new Error("Feature must have ID!");this.id=a.id,this.parseData(a,b,c)},parseData:function(c,d,e){var f=!1,g=_.reduce(c.lines,function(b,c){return c=a.util.cleanupLine(c).replace("..",""),"NØ"===c?f=!0:f?b.geometry.push(c):b.attributes.push(c),b},{attributes:[],geometry:[]});this.attributes=_.reduce(g.attributes,function(a,b){return b=b.split(" "),a[b.shift()]=b.join(" "),a},{}),this.geometry=b(c.geometryType,g.geometry,d,e)}}),a.Features=a.Base.extend({initialize:function(b,c){this.hode=c,this.features=_.map(b,function(b,d){d=d.replace(":","").split(" ");var e={id:parseInt(d[1],10),geometryType:d[0],lines:b};return new a.Feature(e,c.origo,c.enhet)})},length:function(){return this.features.length},at:function(a){return this.features[a]}})}(SOSI);var SOSI=window.SOSI||{};!function(a){"use strict";function b(b){return 1===a.util.countStartingDots(b)}function c(a){return!(a[0]&&"!"!==a[0])}var d=a.Base.extend({}),e=a.Base.extend({}),f=a.Base.extend({initialize:function(b){this.hode=new a.Head(b.HODE),this.def=new d(b.DEF),this.objdef=new e(b.OBJDEF),this.features=new a.Features(_.omit(b,["HODE","DEF","OBJDEF","SLUTT"]),this.hode)}});a.Parser=a.Base.extend({parse:function(d){var e,g=_.reduce(d.split("\n"),function(d,f){if(!c(f))if(b(f)){var g=a.util.cleanupLine(f.replace(".",""));d[g]=[],e=g}else e&&d[e].push(f);return d},{});return new f(g)}})}(SOSI);